function pfmTooltips(e,a,t,n){var i=new Date(e[0].data[0]),r="<h3>"+formatDate(i)+"</h3>",s="name";"cn"==n&&(s="name_cn");for(var o in e){var m=nameInfo[e[o].seriesName];if(m){var d="<div>"+e[o].marker+m[s]+": "+e[o].data[1]+"</div>";r+=d}}return r='<h3 style="color:#ffffff;margin:5px 20px">'+e[0].name+"</h3>"+r}function pfmTooltipsCN(e,a,t){return pfmTooltips(e,a,t,"cn")}function initChart(){myChart=currentTheme&&"DarkShadow"===currentTheme?echarts.init(document.getElementById("main"),"dark"):echarts.init(document.getElementById("main")),myChart.getZr().on("click",function(e){if(null!=last_pos){if(last_pos[0]==e.offsetX&&last_pos[1]==e.offsetY){for(var a,t=myChart.getOption(),n=0;;){if(0!=currentOptions.series[n].data.length){a=t.xAxis[n].axisPointer.value;break}if(n+=1,n>20)return}markArea(a);for(var i=0;i<t.series.length;i++)for(var r=0;r<t.series[i].data.length;r++)if(t.series[i].data[r][0]==a){currentOptions.series[i].markArea.data.push([{name:currentOptions.series[i].data[r][1].toString(),xAxis:a-1e3},{xAxis:a}]);break}myChart.setOption(currentOptions)}last_pos=null}last_pos=[e.offsetX,e.offsetY]})}function addData(e){var a="";try{a=JSON.parse(e)}catch(t){a=e}if(a.name in nameInfo){var n=nameInfo[a.name].index;nameInfo[a.name].div1024&&(a.value=(a.value/1024).toFixed(2)),"cpu_freq"==a.name?insertCpuCore(JSON.parse(a.value),shift):currentOptions.series[n].data.push([a.time,a.value]),myChart.setOption(currentOptions)}}function insertCpuCore(e,a){if(currentOptions.series.length<names+coreNum)for(var t=0;coreNum>t;t++)currentOptions.series.push({type:"bar",stack:"core",name:"cpu-core_"+t,data:[],xAxisIndex:5,yAxisIndex:5});_.forEach(e,function(e,t){var n=parseInt(t);currentOptions.series[names+n].data.push(e),a&&currentOptions.series[names+n].data.shift()})}function changeChartsLang(e){currentOptions.title.text=window.chartTitle,"cn"==e&&($(["cpu","pss","net_flow","battery_temperature","fps","jank","bigjank"]).each(function(e,a){currentOptions.yAxis[e].name=nameInfo[a].name_cn}),currentOptions.tooltip.formatter=pfmTooltipsCN)}function clearData(){currentOptions=_.cloneDeep(baseOptions),myChart.dispose(),initChart(),changeChartsLang(window.currentLang)}var nameInfo={cpu:{index:0,unit:"%",name:"CPU usage (%)",name_cn:"CPU占用(%)",div1024:!1},pss:{index:1,unit:"MB",name:"Memory usage (MB)",name_cn:"内存占用(MB)",div1024:!0},net_flow:{index:2,unit:"KB/s",name:"Network traffic (KB/s)",name_cn:"网络流量(KB/s)",div1024:!0},battery_temperature:{index:3,unit:"℃",name:"Battery temperature (°C)",name_cn:"电池温度(℃)",div1024:!1},fps:{index:4,unit:"Hz",name:"FPS(Hz)",name_cn:"FPS(Hz)",div1024:!1},jank:{index:5,unit:"Times",name:"Jank(Times)",name_cn:"卡顿(次)",div1024:!1},bigjank:{index:6,unit:"Times",name:"BigJank(Times)",name_cn:"严重卡顿(次)",div1024:!1}};baseOptions={grid:[{top:50,height:145},{top:255,height:145},{top:460,height:145},{top:665,height:145},{top:870,height:145},{top:1075,height:145},{top:1280,height:145},{top:1485,height:145}],xAxis:[{type:"time",gridIndex:0,data:[]},{type:"time",gridIndex:1,data:[]},{type:"time",gridIndex:2,data:[]},{type:"time",gridIndex:3,data:[]},{type:"time",gridIndex:4,data:[]},{type:"time",gridIndex:5,data:[]},{type:"time",gridIndex:6,data:[]}],yAxis:[{type:"value",gridIndex:0,name:nameInfo.cpu.name},{type:"value",gridIndex:1,name:nameInfo.pss.name},{type:"value",gridIndex:2,name:nameInfo.net_flow.name},{type:"value",gridIndex:3,name:nameInfo.battery_temperature.name},{type:"value",gridIndex:4,name:nameInfo.fps.name},{type:"value",gridIndex:5,name:nameInfo.jank.name},{type:"value",gridIndex:6,name:nameInfo.bigjank.name}],series:[{type:"line",xAxisIndex:0,yAxisIndex:0,name:"cpu",data:[],markLine:{data:[{name:"avg",type:"average"}]},markArea:{silent:!0,label:{show:!0,position:"insideBottomLeft"},data:[]}},{type:"line",xAxisIndex:1,yAxisIndex:1,name:"pss",data:[],markLine:{data:[{name:"avg",type:"average"}]},markArea:{silent:!0,label:{show:!0,position:"insideBottomLeft"},data:[]}},{type:"line",xAxisIndex:2,yAxisIndex:2,name:"net_flow",data:[],markLine:{data:[{name:"avg",type:"average"}]},markArea:{silent:!0,label:{show:!0,position:"insideBottomLeft"},data:[]}},{type:"line",xAxisIndex:3,yAxisIndex:3,name:"battery_temperature",data:[],markLine:{data:[{name:"avg",type:"average"}]},markArea:{silent:!0,label:{show:!0,position:"insideBottomLeft"},data:[]}},{type:"line",xAxisIndex:4,yAxisIndex:4,name:"fps",data:[],markLine:{data:[{name:"avg",type:"average"}]},markArea:{silent:!0,label:{show:!0,position:"insideBottomLeft"},data:[]}},{type:"line",xAxisIndex:5,yAxisIndex:5,name:"jank",data:[],markLine:{data:[{name:"avg",type:"average"}]},markArea:{silent:!0,label:{show:!0,position:"insideBottomLeft"},data:[]}},{type:"line",xAxisIndex:6,yAxisIndex:6,name:"bigjank",data:[],markLine:{data:[{name:"avg",type:"average"}]},markArea:{silent:!0,label:{show:!0,position:"insideBottomLeft"},data:[]}}],legend:{data:[]},tooltip:{trigger:"axis",axisPointer:{},formatter:pfmTooltips},axisPointer:{link:{xAxisIndex:"all"}},renderer:"svg",title:{text:window.chartTitle,textStyle:{fontSize:12}}};var currentOptions=_.cloneDeep(baseOptions),names=7,coreNum=0,myChart=null,currentTheme="DarkShadow",last_pos=null;initChart();